# RUNTIME SERVER ERRORS
# These errors occur on the server during request execution.
# Copy this file to lowdefy.yaml to test server errors.

lowdefy: local

connections:
  # Valid connection for testing request errors
  - id: testApi
    type: AxiosHttp
    properties:
      baseURL: https://httpstat.us

requests:
  # Request that will return 500 error
  - id: serverError500
    connection: testApi
    properties:
      url: /500

  # Request that will return 404 error
  - id: notFound404
    connection: testApi
    properties:
      url: /404

  # Request that will timeout
  - id: slowRequest
    connection: testApi
    properties:
      url: /200?sleep=30000
      timeout: 1000

  # Request with operator error in properties
  - id: requestWithOperatorError
    connection: testApi
    properties:
      url:
        _string.concat:
          - /200
          # This will throw on server: _sum expects array
          - _sum: not-array

  # Request with transformation error
  - id: requestWithTransformError
    connection: testApi
    properties:
      url: /200
    transformation:
      # _and expects array, will throw during transformation
      result:
        _and: not-array

pages:
  - id: home
    type: Box
    blocks:
      - id: header
        type: Title
        properties:
          content: Runtime Server Error Test Page

      - id: description
        type: Paragraph
        properties:
          content: Click buttons to trigger server-side errors during request execution.

      - id: buttonsBox
        type: Box
        layout:
          contentGutter: 16
        blocks:
          # Button to trigger 500 server error
          - id: trigger500Button
            type: Button
            properties:
              title: Trigger 500 Server Error
              type: danger
            events:
              onClick:
                - id: call500
                  type: Request
                  params: serverError500

          # Button to trigger 404 error
          - id: trigger404Button
            type: Button
            properties:
              title: Trigger 404 Not Found
              type: danger
            events:
              onClick:
                - id: call404
                  type: Request
                  params: notFound404

          # Button to trigger timeout
          - id: triggerTimeoutButton
            type: Button
            properties:
              title: Trigger Timeout Error
              type: danger
            events:
              onClick:
                - id: callSlow
                  type: Request
                  params: slowRequest

          # Button to trigger operator error in request
          - id: triggerOperatorErrorButton
            type: Button
            properties:
              title: Trigger Request Operator Error
              type: danger
            events:
              onClick:
                - id: callOperatorError
                  type: Request
                  params: requestWithOperatorError

          # Button to trigger transformation error
          - id: triggerTransformErrorButton
            type: Button
            properties:
              title: Trigger Transformation Error
              type: danger
            events:
              onClick:
                - id: callTransformError
                  type: Request
                  params: requestWithTransformError

      - id: resultsTitle
        type: Title
        properties:
          level: 3
          content: Request Results

      - id: resultsDisplay
        type: Paragraph
        properties:
          content:
            _if:
              test:
                _state: requestResult
              then:
                _string.concat:
                  - 'Result: '
                  - _json.stringify:
                      - _state: requestResult
              else: Click a button above to test server errors.
